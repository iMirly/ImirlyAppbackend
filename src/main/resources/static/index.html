<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>iMirly â€” Servicios</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="toolbar">
    <h2 style="margin:0; flex:1;">iMirly â€” Servicios Profesionales</h2>
    <span id="sessionInfo" class="muted"></span>
    <button id="btnH2Console" class="hidden secondary" onclick="openH2Console()">ğŸ—„ï¸ H2 Console</button>
    <button id="btnLogout" class="hidden" onclick="logout()">Cerrar sesiÃ³n</button>
  </div>

  <!-- =========================
       SCREEN: AUTH (LOGIN + REGISTER)
  ========================== -->
  <section id="screen-auth" class="card">
    <h3>Acceso</h3>
    <p class="muted">Inicia sesiÃ³n si ya tienes cuenta o regÃ­strate para ofrecer o contratar servicios.</p>

    <div class="row">

      <!-- LOGIN -->
      <div class="card">
        <h4>Iniciar sesiÃ³n</h4>

        <label for="loginEmail">Email *</label>
        <input id="loginEmail" type="email" placeholder="tu@email.com" />
        <div id="err-loginEmail" class="error"></div>

        <label for="loginPassword">ContraseÃ±a *</label>
        <input id="loginPassword" type="password" placeholder="Tu contraseÃ±a" />
        <div id="err-loginPassword" class="error"></div>

        <button class="primary" onclick="login()">Iniciar sesiÃ³n</button>
        <div id="err-loginGeneral" class="error"></div>
      </div>

      <!-- REGISTER -->
      <div class="card">
        <h4>Crear cuenta</h4>

        <label for="regNombre">Nombre completo *</label>
        <input id="regNombre" type="text" placeholder="Tu nombre" />
        <div id="err-regNombre" class="error"></div>

        <label for="regEmail">Email *</label>
        <input id="regEmail" type="email" placeholder="tu@email.com" />
        <div id="err-regEmail" class="error"></div>

        <label for="regPassword">ContraseÃ±a *</label>
        <input id="regPassword" type="password" placeholder="MÃ­nimo 6 caracteres" />
        <div id="err-regPassword" class="error"></div>

        <label for="regConfirmPassword">Confirmar contraseÃ±a *</label>
        <input id="regConfirmPassword" type="password" placeholder="Repite tu contraseÃ±a" />
        <div id="err-regConfirmPassword" class="error"></div>

        <button class="primary" onclick="register()">Crear cuenta</button>
        <div id="err-registerGeneral" class="error"></div>
      </div>

    </div>
  </section>


  <!-- =========================
       SCREEN: DASHBOARD (LOGUEADO)
  ========================== -->
  <section id="screen-dashboard" class="hidden">
    <div class="row">

      <!-- PERFIL -->
      <div class="card" style="flex: 0 0 300px;">
        <h3>Mi cuenta</h3>

        <div id="profileInfo" class="profile-box">
          <p><strong id="profileName"></strong></p>
          <p id="profileEmail" class="muted"></p>
          <p id="profileCompleteness" class="badge"></p>
        </div>

        <button onclick="showEditProfileForm()">âœï¸ Editar perfil</button>
        <button onclick="showChangePasswordForm()">ğŸ”’ Cambiar contraseÃ±a</button>

        <hr />

        <button class="danger" onclick="deleteAccount()">ğŸ—‘ï¸ Eliminar cuenta</button>

        <hr />

        <button class="primary" onclick="goExplore()">ğŸ” Ver servicios disponibles</button>

        <hr />
        <button onclick="showScreen('favoritos'); loadMisFavoritos();">â¤ï¸ Mis Favoritos</button>

        <hr />
        <button onclick="showScreen('mensajes'); renderizarConversaciones();">ğŸ’¬ Mensajes</button>

        <!-- Formulario editar perfil -->
        <div id="editProfileForm" class="hidden form-section">
          <h4>Completar datos personales</h4>
          <p class="muted small">Necesarios para publicar servicios</p>

          <label>TelÃ©fono *</label>
          <input id="editTelefono" type="tel" placeholder="612345678" maxlength="9">

          <label>Fecha de nacimiento *</label>
          <input id="editFechaNacimiento" type="date">

          <label>DirecciÃ³n (calle y nÃºmero) *</label>
          <input id="editCalle" type="text" placeholder="Calle Mayor 45, 3ÂºA">

          <label>Ciudad *</label>
          <input id="editCiudad" type="text" placeholder="Madrid">

          <label>CÃ³digo Postal *</label>
          <input id="editCP" type="text" placeholder="28013" maxlength="5">

          <label>Foto de perfil (URL)</label>
          <input id="editFoto" type="url" placeholder="https://...">

          <button class="primary" onclick="updateProfile()">ğŸ’¾ Guardar cambios</button>
          <button class="secondary" onclick="hideEditProfileForm()">Cancelar</button>
        </div>

        <!-- Formulario cambiar contraseÃ±a -->
        <div id="changePasswordForm" class="hidden form-section">
          <h4>Cambiar contraseÃ±a</h4>

          <label>ContraseÃ±a actual</label>
          <input id="currentPassword" type="password">

          <label>Nueva contraseÃ±a</label>
          <input id="newPassword" type="password">

          <label>Confirmar nueva contraseÃ±a</label>
          <input id="confirmNewPassword" type="password">

          <button class="primary" onclick="updatePassword()">Cambiar contraseÃ±a</button>
          <button class="secondary" onclick="hideChangePasswordForm()">Cancelar</button>
        </div>
      </div>

      <!-- CREAR ANUNCIO (PASO 1) -->
      <div class="card" style="flex: 1;">
        <h3>Publicar servicio</h3>
        <p class="muted" id="anuncioStepIndicator">Paso 1 de 2: InformaciÃ³n general</p>

        <!-- PASO 1 -->
        <div id="anuncioStep1">
          <label for="anuncioImagen">Imagen del servicio (URL)</label>
          <input id="anuncioImagen" type="url" placeholder="https://...">

          <label for="anuncioCategoria">CategorÃ­a *</label>
          <select id="anuncioCategoria" onchange="cargarSubcategorias()">
            <option value="">Selecciona categorÃ­a</option>
          </select>

          <label for="anuncioSubcategoria">SubcategorÃ­a *</label>
          <select id="anuncioSubcategoria" onchange="mostrarInfoSubcategoria()">
            <option value="">Selecciona subcategorÃ­a</option>
          </select>

          <label for="anuncioTitulo">TÃ­tulo del servicio *</label>
          <input id="anuncioTitulo" type="text" placeholder="Ej: Fontanero profesional con experiencia">

          <label for="anuncioDescripcion">DescripciÃ³n</label>
          <textarea id="anuncioDescripcion" rows="3" placeholder="Describe tu experiencia y servicios..."></textarea>

          <div class="row">
            <div style="flex: 1;">
              <label for="anuncioPrecio">Precio *</label>
              <input id="anuncioPrecio" type="number" step="0.01" min="0" placeholder="50.00">
            </div>
            <div style="flex: 1;">
              <label for="anuncioTipoPrecio">Tipo *</label>
              <select id="anuncioTipoPrecio">
                <option value="POR_HORA">Por hora</option>
                <option value="POR_SERVICIO">Por servicio</option>
                <option value="POR_SESION">Por sesiÃ³n</option>
                <option value="POR_PROYECTO">Por proyecto</option>
                <option value="PRESUPUESTO">Presupuesto</option>
              </select>
            </div>
          </div>

          <label for="anuncioUbicacion">UbicaciÃ³n *</label>
          <input id="anuncioUbicacion" type="text" placeholder="Madrid Centro">

          <button class="primary" onclick="crearAnuncioStep1()">Continuar â†’</button>
        </div>

        <!-- PASO 2 (dinÃ¡mico segÃºn subcategorÃ­a) -->
        <div id="anuncioStep2" class="hidden">
          <div id="camposEspecificos">
            <!-- AquÃ­ se cargan los campos segÃºn la subcategorÃ­a -->
          </div>

          <div class="row">
            <button class="secondary" onclick="volverStep1()">â† AtrÃ¡s</button>
            <button class="primary" onclick="completarAnuncioStep2()">Publicar anuncio</button>
          </div>
        </div>

        <div id="err-anuncioGeneral" class="error"></div>
      </div>

    </div>

    <!-- MIS ANUNCIOS -->
    <div class="card" style="margin-top: 16px;">
      <div class="toolbar">
        <h3 style="margin:0; flex:1;">Mis anuncios</h3>
        <div>
          <button class="secondary" onclick="filtrarMisAnuncios('todos')">Todos</button>
          <button class="secondary" onclick="filtrarMisAnuncios('PUBLICADO')">Activos</button>
          <button class="secondary" onclick="filtrarMisAnuncios('DESPUBLICADO')">Inactivos</button>
          <button class="secondary" onclick="filtrarMisAnuncios('BORRADOR')">Borradores</button>
        </div>
        <button onclick="loadMisAnuncios()">ğŸ”„ Recargar</button>
      </div>
      <div id="misAnunciosList" class="list">
        <p class="muted">Cargando...</p>
      </div>
    </div>
  </section>


  <!-- =========================
       SCREEN: EXPLORE (SERVICIOS PÃšBLICOS)
  ========================== -->
  <section id="screen-explore" class="hidden">
    <div class="card">
      <div class="toolbar">
        <h3 style="margin:0; flex:1;">ğŸ” Explorar servicios</h3>
        <button onclick="goDashboard()">â† Volver a mi cuenta</button>
        <button onclick="loadPublicAnuncios()">ğŸ”„ Recargar</button>
      </div>

      <!-- Filtros -->
      <div class="filters">
        <select id="filtroCategoria" onchange="filtrarPublicos()">
          <option value="">Todas las categorÃ­as</option>
        </select>
        <input type="text" id="filtroBusqueda" placeholder="Buscar..." onkeyup="filtrarPublicos()">
      </div>

      <div id="publicAnunciosList" class="list"></div>
      <div id="err-publicAnunciosGeneral" class="error"></div>
    </div>
  </section>

  <!-- ==================== SCREEN: MENSAJES ==================== -->
  <section id="screen-mensajes" class="hidden">
    <div class="card">
      <div class="toolbar">
        <h3 style="margin:0; flex:1;">ğŸ’¬ Mensajes</h3>
        <button onclick="goDashboard()">â† Volver</button>
      </div>
      <div class="mensajes-layout">
        <div id="listaConversaciones" class="conversaciones-lista">
          <p class="muted">Cargando...</p>
        </div>
        <div id="chatActivo" class="chat-activo">
          <p class="muted">Selecciona una conversaciÃ³n</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ==================== SCREEN: FAVORITOS ==================== -->
  <section id="screen-favoritos" class="hidden">
    <div class="card">
      <div class="toolbar">
        <h3 style="margin:0; flex:1;">â¤ï¸ Mis Favoritos</h3>
        <button onclick="goDashboard()">â† Volver</button>
        <button onclick="loadMisFavoritos()">ğŸ”„ Recargar</button>
      </div>
      <div id="misFavoritosList" class="list">
        <p class="muted">Cargando...</p>
      </div>
    </div>
  </section>

</div>

<script src="/js/app.js"></script>
</body>
</html>